#include "i2c_adapter.h"
#include "rt903x.h"
#include "rt903x_reg.h"
#include "ics_util.h"
#include "string.h"
#include <stdint.h>
#include "esp_log.h"

const uint8_t list_data[] = {1,0,1,0};
#define LIST_DATA_LEN        sizeof(list_data)

//const int8_t wave_data[] =
//{
//	0x02,0x24,0x00,0x5C,
//	0,0,0,0,0,0,0,1,2,3,6,12,24,47,85,106,117,122,125,126,126,124,120,112,97,
//	66,5,-61,-94,-111,-120,-124,-126,-126,-126,-124,-120,-112,-96,-64,-3,34,
//	26,-30,-79,-103,-116,-122,-125,-127,-127,-128,-128,-128,-128,-128,-127,
//	-125,-123,-117,-106,-84,-44,-16,-2,6,9,11,12,12,13,13,13,13,13,14,15,18,
//	22,22,11,6,3,1,0,0,0,0,0,0,0,0
//};


//const int8_t wave_data[] =
//{
//		0x02,0x24,0x01,0x2E,
//		0,3,7,11,14,16,18,19,19,18,16,14,11,7,4,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0
//};

//200hz 50ms ,0.15*Vmax
//const int8_t wave_data[] =
//	{
//	    0x02,0x24,0x01,0x2d,
//		0,3,7,11,14,16,18,19,19,18,16,14,11,7,4,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,
//	};
const int8_t wave_data[] =
{// 200hz 2T  1*Vmax
		0x02,0x24,0x00,0x3d,
		2,26,52,75,95,110,121,127,127,121,110,95,75,51,26,-1,-27,-53,-76,-96,-111,-122,-127,-127,-122,-111,-96,-76,-53,-27,0,26,52,75,95,110,121,127,127,121,110,95,75,52,26,0,-27,-52,-76,-96,-111,-122,-127,-127,-122,-111,-96,-76,-53,-27,
};

static const int8_t r_125hz[]=
{0x02,0x24,0x01, 0x7C, 0,-3,-4,-6,-5,-3,0,6,15,25,37,50,63,75,85,94,100,104,106,105,104,100,96,89,82,73,63,51,38,24,10,-4,-19,-32,-46,-58,-68,-78,-86,-93,-99,-104,-106,-107,-105,-101,-95,-87,-77,-67,-57,-48,-41,-37,-35,-37,-40,-46,-53,-60,-67,-72,-77,-79,-80,-79,-77,-74,-70,-65,-60,-53,-46,-39,-30,-20,-10,0,8,18,27,34,41,46,51,54,57,59,60,60,59,57,55,51,47,42,36,30,24,18,13,8,4,1,0,-1,-2,-3,-2,-1,-1,0};

static const int8_t r_200hz[]=
{0x02,0x24,0x01, 0x5A, -1,-4,-7,-10,-9,-6,0,11,24,40,57,73,88,99,107,109,106,98,85,68,48,25,2,-21,-43,-64,-82,-95,-104,-108,-107,-101,-92,-79,-66,-52,-40,-31,-25,-22,-23,-26,-31,-37,-43,-48,-51,-53,-54,-53,-52,-50,-48,-47,-45,-44,-42,-39,-36,-31,-26,-20,-14,-8,-3,1,6,10,14,18,21,25,28,32,35,37,39,40,41,40,39,38,36,34,33,31,29,27,24,21,18,15,11,8,5,2,0,-1,-2,-1,-2,-1,0};

static const int8_t r_300hz[]=
{0x02,0x24,0x00, 0xBD, 0,0,-3,-8,-13,-13,-8,2,18,39,61,81,97,105,103,90,68,38,5,-28,-57,-80,-94,-98,-94,-84,-69,-54,-41,-30,-24,-22,-22,-23,-23,-21,-17,-9,0,9,19,26,30,30,27,21,14,5,-2,-8,-11,-12,-11,-7,-3,0,2,1,0};

static const int8_t r_400hz[]=
{0x02,0x24,0x00, 0xB8, -1,-6,-13,-18,-15,-5,9,28,48,66,78,82,78,64,42,15,-13,-39,-61,-75,-82,-81,-73,-62,-50,-39,-30,-24,-21,-19,-18,-17,-13,-7,0,9,18,26,32,34,33,28,20,11,2,-4,-10,-12,-12,-10,-7,-2,2,3,2,0,0};

static const int8_t l_125hz[]=
{0x02,0x24,0x01, 0x6F, 0,-3,-4,-6,-5,-3,0,6,15,25,37,50,63,75,85,94,100,104,106,105,104,100,96,89,82,73,63,51,38,24,9,-4,-19,-32,-46,-57,-68,-78,-86,-93,-99,-104,-106,-107,-105,-101,-94,-87,-78,-68,-59,-52,-46,-43,-43,-45,-49,-54,-60,-67,-72,-76,-79,-80,-79,-76,-73,-68,-62,-55,-48,-39,-30,-20,-10,0,10,19,29,37,43,49,53,57,59,60,60,59,58,55,51,46,41,35,29,22,16,11,6,2,0,-1,-3,-2,-3,-2,-1,0};
static const int8_t l_200hz[]=
{0x02,0x24,0x01, 0x58, 0,-4,-7,-10,-9,-6,0,9,22,38,55,71,86,98,106,109,107,99,87,70,51,28,4,-18,-41,-62,-80,-94,-103,-107,-106,-101,-92,-80,-66,-53,-42,-33,-28,-26,-28,-33,-39,-47,-53,-59,-64,-66,-67,-66,-65,-63,-61,-59,-56,-53,-50,-46,-41,-36,-29,-22,-13,-6,0,7,13,19,24,28,32,36,40,44,47,49,50,51,50,49,47,45,42,39,36,33,29,26,22,18,14,10,6,3,0,-1,-2,-3,-3,-2,-2,0,0};
static const int8_t l_300hz[]=
{0x02,0x24,0x00, 0xBF, 0,0,-3,-9,-12,-12,-7,4,21,41,63,83,98,105,101,88,65,35,1,-31,-60,-82,-95,-99,-94,-83,-69,-54,-41,-32,-26,-24,-25,-26,-26,-24,-18,-10,-1,9,19,27,32,33,30,24,16,7,0,-5,-9,-11,-10,-7,-3,0,2,3,1,0};
static const int8_t l_400hz[]=
{0x02,0x24,0x00, 0xBA, -1,-6,-13,-18,-16,-6,9,28,48,67,79,83,78,63,40,13,-14,-41,-61,-74,-79,-76,-68,-55,-43,-32,-24,-20,-19,-20,-21,-21,-19,-14,-5,4,15,24,31,34,34,29,22,12,3,-4,-10,-14,-14,-11,-7,-2,2,3,2,0,0};

static const int8_t* r_playList[] = 
{
	r_125hz,r_200hz,r_300hz,r_400hz
};
static const uint32_t r_playList_len[]=
{
	sizeof(r_125hz),sizeof(r_200hz),sizeof(r_300hz),sizeof(r_400hz),
};
static const int8_t* l_playList[] = 
{
	l_125hz,l_200hz,l_300hz,l_400hz
};
static const uint32_t l_playList_len[]=
{
	sizeof(l_125hz),sizeof(l_200hz),sizeof(l_300hz),sizeof(l_400hz),
};


#define WAVE_DATA_LEN        sizeof(wave_data)

//仅仅是demo使用， number数需要在0-3之间
//area  ,0 是左， 1是右
int16_t rt903x_Ram_Play_Demo(DEF_RT903_INFO i2c_config, uint8_t gain, uint8_t number, uint8_t area)
{
	if (number >3) return -1;
	if(gain > 0x80) return -1;
	int16_t res = 0;

	// Clear all interruptions
	res = rt903x_clear_int(i2c_config);
  	CHECK_ERROR_RETURN(res);

	// Fill the list data and waveform data
	res = rt903x_playlist_data(i2c_config, list_data,LIST_DATA_LEN);
	CHECK_ERROR_RETURN(res);
	// Fill the waveform data.
	if(0 == area )
	{
		res = rt903x_waveform_data(i2c_config, (const uint8_t*)l_playList[number],l_playList_len[number]);
		CHECK_ERROR_RETURN(res);
	}else{
		res = rt903x_waveform_data(i2c_config, (const uint8_t*)r_playList[number],r_playList_len[number]);
		CHECK_ERROR_RETURN(res);
	}

	
	res = rt903x_gain(i2c_config, gain);
	CHECK_ERROR_RETURN(res);
	res = rt903x_boost_voltage(i2c_config, BOOST_VOUT_850);
	CHECK_ERROR_RETURN(res);

	res = rt903x_play_mode(i2c_config, MODE_RAM_PLAY);
	CHECK_ERROR_RETURN(res);

	res = rt903x_go(i2c_config, 1);
	CHECK_ERROR_RETURN(res);
	
	return 0;
}
