#include "i2c_adapter.h"
#include "rt903x.h"
#include "rt903x_reg.h"
#include "ics_util.h"
#include "string.h"
#include <stdint.h>
#include "esp_log.h"

const uint8_t list_data[] = {1,0,1,0};
#define LIST_DATA_LEN        sizeof(list_data)

//const int8_t wave_data[] =
//{
//	0x02,0x24,0x00,0x5C,
//	0,0,0,0,0,0,0,1,2,3,6,12,24,47,85,106,117,122,125,126,126,124,120,112,97,
//	66,5,-61,-94,-111,-120,-124,-126,-126,-126,-124,-120,-112,-96,-64,-3,34,
//	26,-30,-79,-103,-116,-122,-125,-127,-127,-128,-128,-128,-128,-128,-127,
//	-125,-123,-117,-106,-84,-44,-16,-2,6,9,11,12,12,13,13,13,13,13,14,15,18,
//	22,22,11,6,3,1,0,0,0,0,0,0,0,0
//};


//const int8_t wave_data[] =
//{
//		0x02,0x24,0x01,0x2E,
//		0,3,7,11,14,16,18,19,19,18,16,14,11,7,4,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0
//};

//200hz 50ms ,0.15*Vmax
//const int8_t wave_data[] =
//	{
//	    0x02,0x24,0x01,0x2d,
//		0,3,7,11,14,16,18,19,19,18,16,14,11,7,4,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,-1,3,7,11,14,16,18,19,19,18,16,14,11,7,3,-1,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-4,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-5,0,3,7,11,14,16,18,19,19,18,16,14,11,7,3,0,-5,-8,-12,-15,-17,-19,-20,-20,-19,-17,-15,-12,-8,-4,
//	};
const int8_t wave_data[] =
{// 200hz 2T  1*Vmax
		0x02,0x24,0x00,0x3d,
		2,26,52,75,95,110,121,127,127,121,110,95,75,51,26,-1,-27,-53,-76,-96,-111,-122,-127,-127,-122,-111,-96,-76,-53,-27,0,26,52,75,95,110,121,127,127,121,110,95,75,52,26,0,-27,-52,-76,-96,-111,-122,-127,-127,-122,-111,-96,-76,-53,-27,
};
#define WAVE_DATA_LEN        sizeof(wave_data)

int16_t rt903x_Ram_Play_Demo(rt903_i2c_config_t i2c_config)
{
	int16_t res = 0;

	// Clear all interruptions
	res = rt903x_clear_int(i2c_config);
  	CHECK_ERROR_RETURN(res);

	// Fill the list data and waveform data
	res = rt903x_playlist_data(i2c_config, list_data,LIST_DATA_LEN);
	CHECK_ERROR_RETURN(res);
	// Fill the waveform data.
	res = rt903x_waveform_data(i2c_config, (const uint8_t*)wave_data,WAVE_DATA_LEN);
	CHECK_ERROR_RETURN(res);
	
	res = rt903x_gain(i2c_config, 0x80);
	CHECK_ERROR_RETURN(res);
	res = rt903x_boost_voltage(i2c_config, BOOST_VOUT_850);
	CHECK_ERROR_RETURN(res);

	res = rt903x_play_mode(i2c_config, MODE_RAM_PLAY);
	CHECK_ERROR_RETURN(res);

	res = rt903x_go(i2c_config, 1);
	CHECK_ERROR_RETURN(res);
	
	return 0;
}
